#!/usr/bin/env php
<?php

// Enrico Simonetti
// enricosimonetti.com
//
// 2018-01-25 on Sugar 7.9.3.0
//
// Tool that helps package Sugar installable modules

if (is_file($autoload = getcwd() . '/vendor/autoload.php')) {
    require $autoload;
}

use SugarModulePackager\IllegalStateException;
use SugarModulePackager\ManifestIncompleteException;
use SugarModulePackager\Packager;
use SugarModulePackager\PackagerConfiguration;
use SugarModulePackager\PackagerService;
use SugarModulePackager\FileReaderWriterImpl;
use SugarModulePackager\EchoMessageOutputter;

$messenger = new EchoMessageOutputter();

if (empty($argv[1])) {
    $messenger->message('Use '.$argv[0].' [version]');
    return;
}

$config = new PackagerConfiguration($argv[1], Packager::SW_NAME, Packager::SW_VERSION);

$packagerService = new PackagerService(new FileReaderWriterImpl());
$packager = new Packager($packagerService, $messenger, $config);

try {
    $packager->build($argv[1]);
} catch (IllegalStateException $e) {
    $messenger->message($e->getMessage());
} catch (ManifestIncompleteException $e) {
    $messenger->message($e->getMessage());
}

exit(0);
